# ğŸ”¥ Nuclear Lighters Infrastructure

[![Pipeline Status](https://gitlab.example.net/infrastructure/nl/production/badges/main/pipeline.svg)](https://gitlab.example.net/infrastructure/nl/production/-/pipelines)
[![License: WTFPL](https://img.shields.io/badge/License-WTFPL-brightgreen.svg)](http://www.wtfpl.net/about/)

**Hybrid GitOps Infrastructure as Code for the Nuclear Lighters homelab.**

This repository is the **single source of truth** for the entire Nuclear Lighters infrastructure â€” managing network devices, virtual machines, containers, Kubernetes deployments, and 60+ Docker services through GitLab CI/CD pipelines with a two-tier GitOps model.

---

## ğŸ¯ Overview

| Component | Technology | Management | Purpose |
|-----------|------------|------------|---------|
| â˜¸ï¸ Kubernetes | K8s v1.34.2 (14 nodes) | Atlantis + Argo CD | Container orchestration |
| ğŸŒ CNI | Cilium v1.18.4 (eBPF) | OpenTofu | Networking + kube-proxy replacement |
| ğŸ”€ Load Balancing | Cilium LB-IPAM + BGP | OpenTofu | LoadBalancer services via BGP |
| ğŸŒ Multi-Site | Cilium ClusterMesh | OpenTofu | Cross-cluster service discovery |
| ğŸ’¾ Storage | NFS + Synology iSCSI CSI | OpenTofu | Dynamic provisioning (RWX + RWO) |
| ğŸ”’ TLS Automation | cert-manager + Let's Encrypt | OpenTofu | Wildcard certificates, DNS-01 validation |
| ğŸ” Secrets | External Secrets + OpenBao | OpenTofu | Centralized secrets management |
| ğŸ›¡ï¸ Service Mesh | Cilium mTLS + SPIRE | OpenTofu | Mutual TLS authentication |
| ğŸ“Š Monitoring | REDACTED_d8074874 + Thanos | Helm | Prometheus, Grafana, Alertmanager |
| ğŸ“œ Logging | syslog-ng â†’ Loki â†’ Grafana | LXC + K8s | Centralized log aggregation |
| ğŸ”„ Backup | Velero + SeaweedFS | Argo CD | Disaster recovery, scheduled backups |
| ğŸ¤– Automation | AWX | OpenTofu | Scheduled jobs, cert sync, maintenance |
| ğŸŒ Network | Cisco IOS/ASA + FRR | GitLab CI/CD | Routers, Switches, Firewalls, BGP |
| ğŸ–¥ï¸ Virtualization | Proxmox VE (5 nodes) | OpenTofu | 100+ LXC, 20+ QEMU VMs |
| ğŸ³ Docker | 60+ Services | GitLab CI/CD | GPU/AI, Media, Databases |
| ğŸ”„ GitOps | Atlantis + Argo CD | - | Pipeline-driven deployments |

---

## ğŸŒ Multi-Site Architecture

Nuclear Lighters spans **4 countries** with a hub-and-spoke topology connected via IPsec VPN mesh:

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                      INTERNET                               â”‚
                              â”‚                                                             â”‚
                              â”‚    AS34927 (iFog)              AS56655 (Gigahost)          â”‚
                              â”‚         â”‚                            â”‚                      â”‚
                              â”‚         â”‚ eBGP                       â”‚ eBGP                 â”‚
                              â”‚         â–¼                            â–¼                      â”‚
                              â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
                              â”‚    â”‚ ğŸ‡¨ğŸ‡­ CH   â”‚                  â”‚ ğŸ‡³ğŸ‡´ NO   â”‚                â”‚
                              â”‚    â”‚ ch-edge â”‚â—„â”€â”€â”€â”€IPsecâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ no-edge â”‚                â”‚
                              â”‚    â”‚ ZÃ¼rich  â”‚                  â”‚ Oslo    â”‚                â”‚
                              â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â”‚
                              â”‚         â”‚                            â”‚                      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                         â”‚        IPsec Mesh          â”‚                         â”‚
              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
              â”‚         â”‚                                                            â”‚        â”‚
              â”‚         â–¼                                                            â–¼        â”‚
              â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
              â”‚    â”‚        ğŸ‡³ğŸ‡± NETHERLANDS           â”‚    â”‚          ğŸ‡¬ğŸ‡· GREECE              â”‚ â”‚
              â”‚    â”‚         (Primary Site)          â”‚    â”‚         (DR Site)               â”‚ â”‚
              â”‚    â”‚                                 â”‚    â”‚                                 â”‚ â”‚
              â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
              â”‚    â”‚  â”‚ nl-rtr01â”‚    â”‚ nl-rtr02â”‚    â”‚    â”‚  â”‚ gr-rtr01â”‚    â”‚ gr-rtr02â”‚    â”‚ â”‚
              â”‚    â”‚  â”‚   RR    â”‚    â”‚   RR    â”‚    â”‚    â”‚  â”‚   RR    â”‚    â”‚   RR    â”‚    â”‚ â”‚
              â”‚    â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚    â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚ â”‚
              â”‚    â”‚       â”‚              â”‚         â”‚    â”‚       â”‚              â”‚         â”‚ â”‚
              â”‚    â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
              â”‚    â”‚              â”‚                 â”‚    â”‚              â”‚                 â”‚ â”‚
              â”‚    â”‚         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”            â”‚    â”‚         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”            â”‚ â”‚
              â”‚    â”‚         â”‚ NL-ASA  â”‚            â”‚    â”‚         â”‚ GR-ASA  â”‚            â”‚ â”‚
              â”‚    â”‚         â”‚ 5508-X  â”‚            â”‚    â”‚         â”‚ 5508-X  â”‚            â”‚ â”‚
              â”‚    â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚    â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚ â”‚
              â”‚    â”‚              â”‚ eBGP            â”‚    â”‚              â”‚ eBGP            â”‚ â”‚
              â”‚    â”‚              â–¼                 â”‚    â”‚              â–¼                 â”‚ â”‚
              â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
              â”‚    â”‚    â”‚   K8s Cluster   â”‚         â”‚    â”‚    â”‚   K8s Cluster   â”‚         â”‚ â”‚
              â”‚    â”‚    â”‚   (7 nodes)     â”‚â—„â•â•â•ClusterMeshâ•â•â•â–ºâ”‚   (7 nodes)     â”‚         â”‚ â”‚
              â”‚    â”‚    â”‚   nl       â”‚         â”‚    â”‚    â”‚   gr       â”‚         â”‚ â”‚
              â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
              â”‚    â”‚                                 â”‚    â”‚                                 â”‚ â”‚
              â”‚    â”‚  Proxmox: 3 nodes              â”‚    â”‚  Proxmox: 2 nodes              â”‚ â”‚
              â”‚    â”‚  Storage: Synology DS1621+    â”‚    â”‚  Storage: Local ZFS            â”‚ â”‚
              â”‚    â”‚  LXC: 100+, QEMU: 20+         â”‚    â”‚  LXC: 10+, QEMU: 10+           â”‚ â”‚
              â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Site Details

| Site | Location | Role | Infrastructure | K8s Nodes |
|------|----------|------|----------------|-----------|
| **ğŸ‡³ğŸ‡± NL** | Netherlands | Primary | 3Ã— Proxmox, Synology NAS, Cisco ASA 5508-X | 7 (3 CP + 4 W) |
| **ğŸ‡¬ğŸ‡· GR** | Greece | Disaster Recovery | 2Ã— Proxmox, Local ZFS, Cisco ASA 5508-X | 7 (3 CP + 4 W) |
| **ğŸ‡¨ğŸ‡­ CH** | ZÃ¼rich, Switzerland | Edge (iFog VPS) | VPS, FRR BGP | - |
| **ğŸ‡³ğŸ‡´ NO** | Oslo, Norway | Edge (Gigahost VPS) | VPS, FRR BGP | - |

##***REMOVED*** Hardware

**Netherlands (Primary)**:
| Node | Hardware | CPU | RAM | Storage |
|------|----------|-----|-----|---------|
| nl-pve01 | Venus Series Mini PC | i9-12900H (20 threads) | 96 GB | NVMe ZFS |
| nl-pve02 | Synology DS1621+ VM | Ryzen V1500B (8 cores) | 16 GB | NAS iSCSI |
| nl-pve03 | Dell Precision 3680 | i9-14900K (32 threads) | 128 GB | NVMe ZFS |

**Greece (DR)**:
| Node | Hardware | CPU | RAM | Storage |
|------|----------|-----|-----|---------|
| gr-pve01 | Venus Series Mini PC | i9-12900H (20 threads) | 96 GB | NVMe ZFS |
| gr-pve02 | Dell PowerEdge T110 II | Xeon E3-1270 V2 (8 threads) | 32 GB | SSD ZFS |

---

## ğŸŒ AS214304 - Public BGP

Nuclear Lighters operates its own **Autonomous System** for global IPv6 connectivity:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           AS214304 - NUCLEAR LIGHTERS                        â”‚
â”‚                                                                              â”‚
â”‚  ASN:        AS214304                                                        â”‚
â”‚  IPv6:       2a0c:9a40:8e20::/48                                            â”‚
â”‚  AS-SET:     AS214304:AS-NUCLEAR-LIGHTERS                                   â”‚
â”‚  Status:     RIPE NCC Assigned (December 2025)                              â”‚
â”‚                                                                              â”‚
â”‚  Upstreams:                                                                  â”‚
â”‚  â”œâ”€â”€ AS34927 (iFog GmbH) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ZÃ¼rich, CH                             â”‚
â”‚  â””â”€â”€ AS56655 (Gigahost AS) â”€â”€â”€â”€â”€â”€â”€â”€ Oslo, NO                               â”‚
â”‚                                                                              â”‚
â”‚  IXP:        FogIXP EU (pending)                                            â”‚
â”‚                                                                              â”‚
â”‚  RIPE Objects:                                                               â”‚
â”‚  â”œâ”€â”€ aut-num:    AS214304                                                   â”‚
â”‚  â”œâ”€â”€ inet6num:   2a0c:9a40:8e20::/48                                        â”‚
â”‚  â”œâ”€â”€ as-set:     AS214304:AS-NUCLEAR-LIGHTERS                               â”‚
â”‚  â”œâ”€â”€ org:        ORG-NL672-RIPE                                             â”‚
â”‚  â””â”€â”€ mntner:     NUCLEAR-LIGHTERS-MNT                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### IPv6 Allocation Plan

```
2a0c:9a40:8e20::/48
â”œâ”€â”€ 2a0c:9a40:8e20::/52  â†’ NL Site (4,096 /64s)
â”‚   â”œâ”€â”€ 2a0c:9a40:8e20::/56  â†’ NL Infrastructure
â”‚   â””â”€â”€ 2a0c:9a40:8e21::/56  â†’ NL Kubernetes Pods
â”œâ”€â”€ 2a0c:9a40:8e30::/52  â†’ GR Site (4,096 /64s)
â”œâ”€â”€ 2a0c:9a40:8e40::/52  â†’ CH Edge (4,096 /64s)
â”œâ”€â”€ 2a0c:9a40:8e50::/52  â†’ NO Edge (4,096 /64s)
â””â”€â”€ 2a0c:9a40:8e60::/52  â†’ Reserved/Future
```

---

## ğŸ”€ BGP Architecture

The network uses a **three-tier BGP architecture** with private ASNs for internal routing:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              BGP ARCHITECTURE                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    EXTERNAL (eBGP) - AS214304                        â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚      Internet â—„â”€â”€â”€â–º ch-edge (AS214304) â—„â”€â”€â”€â–º AS34927 (iFog)         â”‚    â”‚
â”‚  â”‚      Internet â—„â”€â”€â”€â–º no-edge (AS214304) â—„â”€â”€â”€â–º AS56655 (Gigahost)     â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚      Announces: 2a0c:9a40:8e20::/48                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                 â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    INTERNAL (iBGP) - AS65000                         â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚    Full mesh between all FRR routers via IPsec tunnels:             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚    ch-edge â—„â”€â”€â–º no-edge â—„â”€â”€â–º nl-rtr01 â—„â”€â”€â–º nl-rtr02                â”‚    â”‚
â”‚  â”‚       â”‚            â”‚            â”‚             â”‚                      â”‚    â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚    â”‚
â”‚  â”‚                    â”‚            â”‚                                    â”‚    â”‚
â”‚  â”‚              gr-rtr01 â—„â”€â”€â”€â”€â–º gr-rtr02                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚    Route Reflectors: nl-rtr01, nl-rtr02, gr-rtr01, gr-rtr02         â”‚    â”‚
â”‚  â”‚    Clients: ch-edge, no-edge, NL-ASA, GR-ASA                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                 â”‚                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 KUBERNETES (eBGP) - AS65001 per site                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚    NL Site:  ASA (AS65000) â—„â”€â”€eBGPâ”€â”€â–º Cilium nodes (AS65001)        â”‚    â”‚
â”‚  â”‚    GR Site:  ASA (AS65000) â—„â”€â”€eBGPâ”€â”€â–º Cilium nodes (AS65001)        â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚    Advertises: Pod CIDRs, LoadBalancer IPs                          â”‚    â”‚
â”‚  â”‚    Receives: Default route, internal networks                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ASN Summary

| ASN | Scope | Purpose | Nodes |
|-----|-------|---------|-------|
| **AS214304** | Public | Internet peering, IPv6 announcements | ch-edge, no-edge |
| **AS65000** | Private | Internal backbone iBGP mesh | All FRR routers, ASAs |
| **AS65001** | Private | Kubernetes BGP (per site, isolated) | Cilium nodes |

---

## ğŸ”— Cilium ClusterMesh

Cross-cluster service discovery and failover between NL and GR Kubernetes clusters:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CILIUM CLUSTERMESH                                 â”‚
â”‚                                                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚      NL Cluster         â”‚        â”‚      GR Cluster         â”‚          â”‚
â”‚    â”‚      (nl)          â”‚        â”‚      (gr)          â”‚          â”‚
â”‚    â”‚                         â”‚        â”‚                         â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
â”‚    â”‚  â”‚ ClusterMesh     â”‚   â”‚        â”‚   â”‚ ClusterMesh     â”‚   â”‚          â”‚
â”‚    â”‚  â”‚ API Server      â”‚â—„â”€â”€â”¼â”€â”€ mTLS â”€â”€â–ºâ”‚ API Server      â”‚   â”‚          â”‚
â”‚    â”‚  â”‚ (etcd cluster)  â”‚   â”‚        â”‚   â”‚ (etcd cluster)  â”‚   â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
â”‚    â”‚           â”‚             â”‚        â”‚            â”‚            â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
â”‚    â”‚  â”‚  Cilium Agents  â”‚   â”‚        â”‚   â”‚  Cilium Agents  â”‚   â”‚          â”‚
â”‚    â”‚  â”‚  (all nodes)    â”‚   â”‚        â”‚   â”‚  (all nodes)    â”‚   â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
â”‚    â”‚                         â”‚        â”‚                         â”‚          â”‚
â”‚    â”‚  Global Services:       â”‚        â”‚   Global Services:      â”‚          â”‚
â”‚    â”‚  â€¢ thanos-store-nlâ”‚â—„â•â•â•â•â•â•â•â–ºâ”‚  â€¢ thanos-store-grâ”‚          â”‚
â”‚    â”‚  â€¢ thanos-store-grâ”‚  shared â”‚  â€¢ thanos-store-nlâ”‚          â”‚
â”‚    â”‚    (stub)              â”‚endpointsâ”‚    (stub)              â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â”‚  Annotations for Global Services:                                           â”‚
â”‚  â”œâ”€â”€ service.cilium.io/global: "true"   â†’ Discoverable across clusters     â”‚
â”‚  â””â”€â”€ service.cilium.io/shared: "true"   â†’ Export endpoints to remotes      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ClusterMesh Status

| Metric | Value |
|--------|-------|
| Connected Clusters | 2 (nl, gr) |
| Global Services | 4+ |
| Remote Nodes Synced | 7 per cluster |
| Connection | mTLS via IPsec tunnel |

---

## ğŸ“Š Thanos Cross-Site Metrics Federation

Long-term metrics storage and cross-site querying via Thanos:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        THANOS ARCHITECTURE                                   â”‚
â”‚                                                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚      NL Cluster         â”‚        â”‚      GR Cluster         â”‚          â”‚
â”‚    â”‚                         â”‚        â”‚                         â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
â”‚    â”‚  â”‚   Prometheus    â”‚   â”‚        â”‚   â”‚   Prometheus    â”‚   â”‚          â”‚
â”‚    â”‚  â”‚   (HA: 2 pods)  â”‚   â”‚        â”‚   â”‚   (HA: 2 pods)  â”‚   â”‚          â”‚
â”‚    â”‚  â”‚   site: nl      â”‚   â”‚        â”‚   â”‚   site: gr      â”‚   â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
â”‚    â”‚           â”‚ sidecar    â”‚        â”‚            â”‚ sidecar    â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
â”‚    â”‚  â”‚  Thanos Sidecar â”‚   â”‚        â”‚   â”‚  Thanos Sidecar â”‚   â”‚          â”‚
â”‚    â”‚  â”‚  :10901 (gRPC)  â”‚   â”‚        â”‚   â”‚  :10901 (gRPC)  â”‚   â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
â”‚    â”‚           â”‚             â”‚        â”‚            â”‚            â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
â”‚    â”‚  â”‚  Thanos Store   â”‚   â”‚        â”‚   â”‚  Thanos Store   â”‚   â”‚          â”‚
â”‚    â”‚  â”‚  (SeaweedFS S3) â”‚   â”‚        â”‚   â”‚  (SeaweedFS S3) â”‚   â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
â”‚    â”‚           â”‚             â”‚        â”‚            â”‚            â”‚          â”‚
â”‚    â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚          â”‚
â”‚    â”‚                         â”‚        â”‚                         â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
â”‚    â”‚  â”‚                  Thanos Query                       â”‚   â”‚          â”‚
â”‚    â”‚  â”‚   Connects to:                                      â”‚   â”‚          â”‚
â”‚    â”‚  â”‚   â€¢ Local NL sidecars + store                      â”‚   â”‚          â”‚
â”‚    â”‚  â”‚   â€¢ Remote GR store (via ClusterMesh)              â”‚   â”‚          â”‚
â”‚    â”‚  â”‚                                                     â”‚   â”‚          â”‚
â”‚    â”‚  â”‚   Query: {site="nl"} or {site="gr"}                â”‚   â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
â”‚    â”‚                         â”‚                                   â”‚          â”‚
â”‚    â”‚                         â–¼                                   â”‚          â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
â”‚    â”‚  â”‚                    Grafana                           â”‚   â”‚          â”‚
â”‚    â”‚  â”‚   Datasource: Thanos (http://thanos-query:9090)     â”‚   â”‚          â”‚
â”‚    â”‚  â”‚   Cross-site dashboards with site selector          â”‚   â”‚          â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Grafana Datasources

| Datasource | URL | Purpose |
|------------|-----|---------|
| Prometheus | http://prometheus.monitoring:9090 | Local site metrics |
| Thanos | http://thanos-query.monitoring:9090 | Cross-site aggregated metrics |
| Loki | http://loki.logging:3100 | Log aggregation |
| Alertmanager | http://alertmanager.monitoring:9093 | Alert management |

---

## ğŸ” Network Monitoring

Comprehensive network observability with dedicated exporters:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NETWORK MONITORING STACK                              â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         EXPORTERS                                    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”‚  FRR Exporter  â”‚  â”‚ IPsec Exporter â”‚  â”‚ SNMP Exporter  â”‚        â”‚    â”‚
â”‚  â”‚  â”‚  :9342         â”‚  â”‚  :9903         â”‚  â”‚  :9116         â”‚        â”‚    â”‚
â”‚  â”‚  â”‚                â”‚  â”‚                â”‚  â”‚                â”‚        â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ BGP sessions â”‚  â”‚ â€¢ Tunnel state â”‚  â”‚ â€¢ ASA metrics  â”‚        â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Prefix countsâ”‚  â”‚ â€¢ Bytes in/out â”‚  â”‚ â€¢ Interface    â”‚        â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Peer state   â”‚  â”‚ â€¢ Packets      â”‚  â”‚ â€¢ CPU/Memory   â”‚        â”‚    â”‚
â”‚  â”‚  â”‚ â€¢ Uptime       â”‚  â”‚ â€¢ SA lifetime  â”‚  â”‚                â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚          â”‚                   â”‚                   â”‚                  â”‚    â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â”‚                              â”‚                                      â”‚    â”‚
â”‚  â”‚                              â–¼                                      â”‚    â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚    â”‚
â”‚  â”‚                    â”‚   Prometheus    â”‚                             â”‚    â”‚
â”‚  â”‚                    â”‚  (scrapes all)  â”‚                             â”‚    â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚    â”‚
â”‚  â”‚                             â”‚                                      â”‚    â”‚
â”‚  â”‚                             â–¼                                      â”‚    â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚    â”‚
â”‚  â”‚                    â”‚    Grafana      â”‚                             â”‚    â”‚
â”‚  â”‚                    â”‚                 â”‚                             â”‚    â”‚
â”‚  â”‚                    â”‚  Dashboards:    â”‚                             â”‚    â”‚
â”‚  â”‚                    â”‚  â€¢ AS214304 Network Flow                      â”‚    â”‚
â”‚  â”‚                    â”‚  â€¢ BGP Sessions                               â”‚    â”‚
â”‚  â”‚                    â”‚  â€¢ IPsec Tunnels                              â”‚    â”‚
â”‚  â”‚                    â”‚  â€¢ Cilium/Hubble                              â”‚    â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Metrics

| Source | Metrics | Purpose |
|--------|---------|---------|
| FRR Exporter | `frr_bgp_peer_state`, `frr_bgp_peer_prefixes_*` | BGP session health |
| IPsec Exporter | `ipsec_up`, `ipsec_in_bytes`, `ipsec_out_bytes` | VPN tunnel monitoring |
| SNMP Exporter | `snmp_*` (Cisco ASA) | Firewall metrics |
| Cilium | `cilium_bgp_*`, `cilium_endpoint_*` | K8s network metrics |
| Hubble | `hubble_flows_processed_total` | Network flow visibility |

### AS214304 Network Flow Dashboard

5-layer visualization showing traffic flow through the network:

```
Layer 1: Edge Nodes (CH/NO) â”€â”€â”€â”€ Transit BGP with AS34927/AS56655
    â”‚
    â–¼ IPsec
Layer 2: IPsec Tunnels â”€â”€â”€â”€â”€â”€â”€â”€ 12 tunnels connecting all sites
    â”‚
    â–¼
Layer 3: Route Reflectors â”€â”€â”€â”€â”€ nl-rtr01/02, gr-rtr01/02
    â”‚
    â–¼
Layer 4: Cisco ASA Firewalls â”€â”€ BGP to Kubernetes nodes
    â”‚
    â–¼ eBGP (AS65000 â†” AS65001)
Layer 5: Kubernetes Pods â”€â”€â”€â”€â”€â”€ Cilium CNI, 100+ endpoints
```

---

## ğŸ—ï¸ Hybrid GitOps Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SOURCE OF TRUTH                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      ğŸ“‚ GitLab Repository                              â”‚  â”‚
â”‚  â”‚  k8s/          â†’ OpenTofu configs (Atlantis)                          â”‚  â”‚
â”‚  â”‚  k8s/argocd-apps/ â†’ Argo CD manifests                                 â”‚  â”‚
â”‚  â”‚  ansible/      â†’ AWX playbooks                                        â”‚  â”‚
â”‚  â”‚  network/      â†’ Cisco configs                                        â”‚  â”‚
â”‚  â”‚  pve/          â†’ Proxmox VM/LXC configs                               â”‚  â”‚
â”‚  â”‚  docker/       â†’ 60+ service definitions                              â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  ğŸ“Š 1000+ commits â€¢ Terraform State Backend                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      âš¡ GitLab CI/CD Pipeline                                â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚  DRIFT   â”‚ â†’ â”‚ VALIDATE â”‚ â†’ â”‚   PLAN   â”‚ â†’ â”‚  DEPLOY  â”‚                â”‚
â”‚   â”‚  DETECT  â”‚   â”‚          â”‚   â”‚ MR Commentâ”‚   â”‚Auto/Manualâ”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  ğŸ—ï¸ Atlantis (Platform)          â”‚  ğŸ”„ Argo CD (Applications)       â”‚   â”‚
â”‚   â”‚  PR-based OpenTofu workflows     â”‚  Auto-sync with self-healing     â”‚   â”‚
â”‚   â”‚  `atlantis plan` / `apply`       â”‚  GitOps for K8s workloads        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   Custom Runners: [k8s-runner] [cisco-ee] [pve-runner] [docker-runner]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MANAGED INFRASTRUCTURE                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â˜¸ï¸ Kubernetes   â”‚ â”‚ ğŸŒ Cisco       â”‚ â”‚ ğŸ–¥ï¸ Proxmox     â”‚ â”‚ ğŸ³ Docker    â”‚ â”‚
â”‚  â”‚ v1.34.2        â”‚ â”‚ Network        â”‚ â”‚ VE             â”‚ â”‚ Fleet        â”‚ â”‚
â”‚  â”‚ 14 Nodes HA    â”‚ â”‚                â”‚ â”‚ 5 Nodes        â”‚ â”‚              â”‚ â”‚
â”‚  â”‚ (2 clusters)   â”‚ â”‚ â€¢ Routers      â”‚ â”‚                â”‚ â”‚ â€¢ GPU/AI     â”‚ â”‚
â”‚  â”‚                â”‚ â”‚ â€¢ Switches     â”‚ â”‚ â€¢ 100+ LXC     â”‚ â”‚ â€¢ Media      â”‚ â”‚
â”‚  â”‚ Platform:      â”‚ â”‚ â€¢ Firewalls    â”‚ â”‚ â€¢ 20+ QEMU     â”‚ â”‚ â€¢ Databases  â”‚ â”‚
â”‚  â”‚ â€¢ Cilium CNI   â”‚ â”‚ â€¢ Access Pointsâ”‚ â”‚ â€¢ Cloud-init   â”‚ â”‚ â€¢ Matrix     â”‚ â”‚
â”‚  â”‚ â€¢ ClusterMesh  â”‚ â”‚                â”‚ â”‚ â€¢ Templates    â”‚ â”‚ â€¢ Nextcloud  â”‚ â”‚
â”‚  â”‚ â€¢ Thanos       â”‚ â”‚ Auto Drift     â”‚ â”‚                â”‚ â”‚              â”‚ â”‚
â”‚  â”‚ â€¢ Prometheus   â”‚ â”‚ Detection      â”‚ â”‚ OpenTofu       â”‚ â”‚ 60+ Services â”‚ â”‚
â”‚  â”‚ â€¢ Grafana      â”‚ â”‚                â”‚ â”‚ Managed        â”‚ â”‚              â”‚ â”‚
â”‚  â”‚ â€¢ Ingress NGINXâ”‚ â”‚ Python +       â”‚ â”‚                â”‚ â”‚ CI/CD Auto   â”‚ â”‚
â”‚  â”‚ â€¢ AWX          â”‚ â”‚ Netmiko        â”‚ â”‚                â”‚ â”‚ Deploy       â”‚ â”‚
â”‚  â”‚ â€¢ Velero       â”‚ â”‚                â”‚ â”‚                â”‚ â”‚              â”‚ â”‚
â”‚  â”‚ â€¢ cert-manager â”‚ â”‚                â”‚ â”‚                â”‚ â”‚              â”‚ â”‚
â”‚  â”‚ â€¢ External Sec â”‚ â”‚                â”‚ â”‚                â”‚ â”‚              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ğŸ” Drift â†’ ğŸ“ Auto MR â†’ âœ… Reconcile  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Repository Structure
```
production/
â”œâ”€â”€ ğŸ“„ .gitlab-ci.yml              # Main pipeline configuration
â”œâ”€â”€ ğŸ“„ atlantis.yaml               # Atlantis project configuration
â”œâ”€â”€ ğŸ“„ renovate.json               # Automated dependency updates
â”œâ”€â”€ ğŸ“„ README.md                   # You are here! ğŸ‘‹
â”‚
â”œâ”€â”€ ğŸ“ ansible/                    # ğŸ¤– AWX Playbooks
â”‚   â””â”€â”€ ğŸ“ playbooks/
â”‚       â”œâ”€â”€ cert-manager/          #    - TLS cert sync to NPM
â”‚       â”œâ”€â”€ docker/                #    - Docker project collection
â”‚       â”œâ”€â”€ pve/                   #    - Proxmox automation
â”‚       â”œâ”€â”€ snmpd/                 #    - SNMP daemon management
â”‚       â”œâ”€â”€ ssh/                   #    - SSH key distribution
â”‚       â””â”€â”€ updates/               #    - System updates
â”‚
â”œâ”€â”€ ğŸ“ ci/                         # ğŸ”§ Modular pipeline includes
â”‚   â”œâ”€â”€ cisco.yml                  #    Cisco device automation
â”‚   â”œâ”€â”€ k8s.yml                    #    Kubernetes (OpenTofu + Argo CD validation)
â”‚   â”œâ”€â”€ docker.yml                 #    Docker image builds & deployments
â”‚   â”œâ”€â”€ lxc.yml                    #    Proxmox LXC automation
â”‚   â””â”€â”€ qemu.yml                   #    Proxmox QEMU automation
â”‚
â”œâ”€â”€ ğŸ“ k8s/                        # â˜¸ï¸ Kubernetes Infrastructure
â”‚   â”œâ”€â”€ main.tf                    #    Main orchestrator
â”‚   â”œâ”€â”€ variables.tf               #    Input variables
â”‚   â”œâ”€â”€ outputs.tf                 #    Output values
â”‚   â”œâ”€â”€ providers.tf               #    Provider configuration
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ _core/                  #    Core infrastructure (Atlantis)
â”‚   â”‚   â”œâ”€â”€ cert-manager/          #    - TLS certificate automation
â”‚   â”‚   â”œâ”€â”€ cilium/                #    - Cilium BGP configuration
â”‚   â”‚   â”œâ”€â”€ external-secrets/      #    - External Secrets Operator
â”‚   â”‚   â”œâ”€â”€ nfs-provisioner/       #    - NFS StorageClass
â”‚   â”‚   â”œâ”€â”€ nl-nas01-csi/     #    - Synology iSCSI CSI driver
â”‚   â”‚   â”œâ”€â”€ ingress-nginx/         #    - Ingress Controller
â”‚   â”‚   â”œâ”€â”€ gitlab-agent/          #    - GitLab K8s Agent
â”‚   â”‚   â””â”€â”€ REDACTED_b9c50d9a/#    - PDBs for critical workloads
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ namespaces/             #    Application namespaces (Atlantis)
â”‚   â”‚   â”œâ”€â”€ argocd/                #    - Argo CD deployment
â”‚   â”‚   â”œâ”€â”€ awx/                   #    - AWX Ansible automation
â”‚   â”‚   â”œâ”€â”€ cert-manager/          #    - Certificate management
â”‚   â”‚   â”œâ”€â”€ external-secrets/      #    - Secrets sync from OpenBao
â”‚   â”‚   â”œâ”€â”€ logging/               #    - Loki log aggregation
â”‚   â”‚   â”œâ”€â”€ minio/                 #    - S3-compatible storage
â”‚   â”‚   â”œâ”€â”€ monitoring/            #    - Prometheus + Grafana + Thanos
â”‚   â”‚   â”œâ”€â”€ pihole/                #    - Pi-hole DNS
â”‚   â”‚   â”œâ”€â”€ seaweedfs/             #    - Distributed object storage
â”‚   â”‚   â””â”€â”€ velero/                #    - Backup & DR
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ argocd-apps/            #    Argo CD managed applications
â”‚       â”œâ”€â”€ pihole/                #    - Pi-hole DNS ad-blocking
â”‚       â””â”€â”€ velero/                #    - Backup & disaster recovery
â”‚
â”œâ”€â”€ ğŸ“ network/                    # ğŸŒ Cisco Network Configs
â”‚   â”œâ”€â”€ ğŸ“ configs/                #    Device configurations
â”‚   â”‚   â”œâ”€â”€ Router/                #    - Router configs
â”‚   â”‚   â”œâ”€â”€ Switch/                #    - Switch configs
â”‚   â”‚   â”œâ”€â”€ Firewall/              #    - ASA firewall configs
â”‚   â”‚   â””â”€â”€ Access-Point/          #    - Wireless AP configs
â”‚   â””â”€â”€ ğŸ“ scripts/                #    Python automation scripts
â”‚       â”œâ”€â”€ detect_drift.py        #    - Drift detection
â”‚       â”œâ”€â”€ generate_diff.py       #    - Hierarchical diff generator
â”‚       â”œâ”€â”€ direct_deploy.py       #    - Device deployment
â”‚       â”œâ”€â”€ auto_sync_drift.py     #    - Auto-sync deviceâ†’GitLab
â”‚       â””â”€â”€ ...                    #    - More utilities
â”‚
â”œâ”€â”€ ğŸ“ pve/                        # ğŸ–¥ï¸ Proxmox Automation
â”‚   â”œâ”€â”€ ğŸ“ lxc/                    #    LXC container definitions
â”‚   â”‚   â”œâ”€â”€ nl-pve01/          #    - 76 containers
â”‚   â”‚   â”œâ”€â”€ nl-pve02/          #    - 7 containers
â”‚   â”‚   â””â”€â”€ nl-pve03/          #    - 34 containers
â”‚   â””â”€â”€ ğŸ“ qemu/                   #    QEMU VM definitions
â”‚       â”œâ”€â”€ nl-pve01/          #    - 8 VMs
â”‚       â””â”€â”€ nl-pve03/          #    - 14 VMs
â”‚
â””â”€â”€ ğŸ“ docker/                     # ğŸ³ Docker Services & Images
    â”œâ”€â”€ ğŸ“ images/                 #    Custom CI/CD runner images
    â”‚   â”œâ”€â”€ cisco-ee/              #    - Cisco automation (Netmiko)
    â”‚   â”œâ”€â”€ k8s-runner/            #    - K8s runner (tofu, kubectl, helm)
    â”‚   â”œâ”€â”€ docker-runner/         #    - Docker operations
    â”‚   â””â”€â”€ pve-runner/            #    - Proxmox API tools
    â””â”€â”€ ğŸ“ services/               #    60+ Docker service definitions
        â”œâ”€â”€ gpu-ai/                #    - Ollama, Stable Diffusion, Whisper
        â”œâ”€â”€ media/                 #    - Jellyfin, Plex, Navidrome
        â”œâ”€â”€ databases/             #    - Redis, InfluxDB, ProxySQL
        â””â”€â”€ productivity/          #    - Matrix, LibreChat, Nextcloud
```

---

## â˜¸ï¸ Kubernetes Infrastructure

### ğŸ—ï¸ Cluster Architecture

**NL Cluster (nl)** - Primary:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Kubernetes Cluster v1.34.2                                â”‚
â”‚                  api-k8s.example.net:6443                            â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       Control Plane (HA)                              â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚   â”‚  ctrl01   â”‚   â”‚  ctrl02   â”‚   â”‚  ctrl03   â”‚                   â”‚   â”‚
â”‚  â”‚   â”‚  4 CPU     â”‚   â”‚  4 CPU     â”‚   â”‚  4 CPU     â”‚                   â”‚   â”‚
â”‚  â”‚   â”‚  4 GB RAM  â”‚   â”‚  4 GB RAM  â”‚   â”‚  4 GB RAM  â”‚                   â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Worker Nodes                                   â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚   â”‚ worker01â”‚   â”‚ worker02â”‚   â”‚ worker03â”‚   â”‚ worker04â”‚             â”‚   â”‚
â”‚  â”‚   â”‚ 8 CPU   â”‚   â”‚ 6 CPU   â”‚   â”‚ 6 CPU   â”‚   â”‚ 4 CPU   â”‚             â”‚   â”‚
â”‚  â”‚   â”‚ 8 GB    â”‚   â”‚ 8 GB    â”‚   â”‚ 8 GB    â”‚   â”‚ 8 GB    â”‚             â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**GR Cluster (gr)** - Disaster Recovery:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Kubernetes Cluster v1.34.2                                â”‚
â”‚                 gr-api-k8s.example.net:6443                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       Control Plane (HA)                              â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚   â”‚  ctrl01   â”‚   â”‚  ctrl02   â”‚   â”‚  ctrl03   â”‚                   â”‚   â”‚
â”‚  â”‚   â”‚  2 CPU     â”‚   â”‚  2 CPU     â”‚   â”‚  2 CPU     â”‚                   â”‚   â”‚
â”‚  â”‚   â”‚  4 GB RAM  â”‚   â”‚  4 GB RAM  â”‚   â”‚  4 GB RAM  â”‚                   â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Worker Nodes                                   â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚   â”‚ worker01â”‚   â”‚ worker02â”‚   â”‚ worker03â”‚   â”‚ worker04â”‚             â”‚   â”‚
â”‚  â”‚   â”‚ 4 CPU   â”‚   â”‚ 4 CPU   â”‚   â”‚ 4 CPU   â”‚   â”‚ 4 CPU   â”‚             â”‚   â”‚
â”‚  â”‚   â”‚ 8 GB    â”‚   â”‚ 8 GB    â”‚   â”‚ 12 GB   â”‚   â”‚ 8 GB    â”‚             â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ§© Platform Components

| Category | Component | Version | Status | Description |
|----------|-----------|---------|--------|-------------|
| **CNI** | Cilium | v1.18.4 | âœ… | eBPF networking, kube-proxy replacement |
| **Multi-Cluster** | Cilium ClusterMesh | v1.18.4 | âœ… | Cross-site service discovery |
| **Load Balancing** | Cilium BGP + LB-IPAM | - | âœ… | BGP peering with Cisco ASA |
| **Storage** | Synology CSI / Democratic CSI | v1.1.4 | âœ… | iSCSI block storage (RWO) |
| **Storage** | NFS Provisioner | - | âœ… | NFS shares (RWX) |
| **Object Storage** | SeaweedFS | v4.01 | âœ… | S3-compatible distributed storage |
| **Ingress** | NGINX Ingress | v1.14.1 | âœ… | External HTTP/HTTPS access |
| **Monitoring** | REDACTED_d8074874 | v79.10.0 | âœ… | Prometheus, Grafana, Alertmanager |
| **Metrics** | Thanos | - | âœ… | Long-term storage, cross-site query |
| **Logging** | Grafana Loki | v3.5.7 | âœ… | Log aggregation from syslog-ng |
| **Secrets** | External Secrets | v1.1.1 | âœ… | Sync secrets from OpenBao |
| **TLS** | cert-manager | v1.17.1 | âœ… | Let's Encrypt wildcard certificates |
| **Service Mesh** | Cilium mTLS + SPIRE | - | âœ… | Mutual TLS authentication |
| **Backup** | Velero + SeaweedFS | - | âœ… | Scheduled backups, DR |
| **DNS** | Pi-hole | - | âœ… | Ad-blocking DNS |
| **Automation** | AWX | - | âœ… | Ansible automation platform |
| **GitOps** | Argo CD | - | âœ… | Application delivery |

---

## ğŸ” Secrets Management

### Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SECRETS FLOW                                         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   OpenBao    â”‚ â”€â”€â”€â–¶ â”‚ External Secrets  â”‚ â”€â”€â”€â–¶ â”‚  K8s Secrets         â”‚ â”‚
â”‚  â”‚ (HA Cluster) â”‚      â”‚    Operator       â”‚      â”‚  (per namespace)     â”‚ â”‚
â”‚  â”‚              â”‚      â”‚                   â”‚      â”‚                      â”‚ â”‚
â”‚  â”‚ NL + GR Raft â”‚      â”‚ ClusterSecretStoreâ”‚      â”‚ â€¢ cloudflare-api     â”‚ â”‚
â”‚  â”‚              â”‚      â”‚ "openbao"         â”‚      â”‚ â€¢ grafana-admin      â”‚ â”‚
â”‚  â”‚ secret/k8s/  â”‚      â”‚                   â”‚      â”‚ â€¢ pihole-password    â”‚ â”‚
â”‚  â”‚ â”œâ”€ argocd/   â”‚      â”‚ ExternalSecret    â”‚      â”‚ â€¢ minio-credentials  â”‚ â”‚
â”‚  â”‚ â”œâ”€ awx/      â”‚      â”‚ (per namespace)   â”‚      â”‚ â€¢ velero-s3-creds    â”‚ â”‚
â”‚  â”‚ â”œâ”€ monitoringâ”‚      â”‚                   â”‚      â”‚ â€¢ npm-credentials    â”‚ â”‚
â”‚  â”‚ â”œâ”€ pihole/   â”‚      â”‚ Refresh: 1h       â”‚      â”‚ â€¢ k8s-api-creds      â”‚ â”‚
â”‚  â”‚ â””â”€ velero/   â”‚      â”‚                   â”‚      â”‚                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### OpenBao HA Cluster

| Node | Location | Role |
|------|----------|------|
| nl-vault01 | NL | Leader/Standby |
| nl-vault02 | NL | Standby |
| gr-vault01 | GR | Standby |

---

## ğŸ› ï¸ Quick Start

### Making Kubernetes Changes

**Platform Infrastructure (Atlantis):**
```bash
# 1. Create feature branch
git checkout -b feature/add-new-service

# 2. Edit OpenTofu files
vim k8s/namespaces/new-service/main.tf

# 3. Push and create MR
git add -A && git commit -m "feat(k8s): Add new-service"
git push -u origin feature/add-new-service

# 4. Atlantis comments the plan on MR
# 5. Review plan, then comment: atlantis apply
# 6. Merge MR after apply succeeds
```

### Making Network Changes
```bash
# 1. Edit the device config
vim network/configs/Router/nl-lte01

# 2. Commit and push
git add network/configs/Router/nl-lte01
git commit -m "feat(router): Add new VLAN interface"
git push origin main

# 3. Pipeline automatically:
#    âœ… Validates syntax
#    ğŸ” Checks for drift (blocks if device was modified via SSH)
#    ğŸ“ Generates hierarchical diff
#    ğŸš€ Deploys ONLY the changes
#    âœ”ï¸ Verifies device is reachable
```

---

## ğŸ†˜ Troubleshooting

### â˜¸ï¸ Kubernetes Issues

**Check Cilium status:**
```bash
cilium status
cilium bgp peers
cilium connectivity test
```

**Check ClusterMesh:**
```bash
cilium clustermesh status
kubectl get svc -A -o json | jq '.items[] | select(.metadata.annotations["service.cilium.io/global"]=="true") | .metadata.name'
```

**Check Thanos stores:**
```bash
curl -s http://thanos-query.monitoring:9090/api/v1/stores | jq
```

### ğŸŒ BGP Issues

**Check FRR BGP on edge nodes:**
```bash
ssh ch-edge "vtysh -c 'show bgp summary'"
ssh no-edge "vtysh -c 'show bgp ipv6 unicast'"
```

**Check Cilium BGP:**
```bash
cilium bgp peers
cilium bgp routes advertised ipv4 unicast
```

---

## ğŸ¤ Contributing

### Commit Message Format
```
<type>(<scope>): <description>

Types: feat, fix, docs, refactor, test, chore
Scopes: k8s, argocd, cisco, pve, docker, ci, cilium, cert-manager, awx, thanos, clustermesh
```

---

## ğŸ“œ License
```
            DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
                    Version 2, December 2004

 Copyright (C) 2004 Sam Hocevar <sam@hocevar.net>

 Everyone is permitted to copy and distribute verbatim or modified
 copies of this license document, and changing it is allowed as long
 as the name is changed.

            DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION

  0. You just DO WHAT THE FUCK YOU WANT TO.
```

---

<p align="center">
  <img src="https://img.shields.io/badge/Made%20with-â¤ï¸-red" alt="Made with love">
  <img src="https://img.shields.io/badge/Powered%20by-GitLab-orange" alt="Powered by GitLab">
  <img src="https://img.shields.io/badge/GitOps-Atlantis%20%2B%20Argo%20CD-blue" alt="GitOps">
  <img src="https://img.shields.io/badge/CNI-Cilium%20eBPF-purple" alt="Cilium">
  <img src="https://img.shields.io/badge/Multi--Site-ClusterMesh-green" alt="ClusterMesh">
  <img src="https://img.shields.io/badge/ASN-AS214304-yellow" alt="AS214304">
  <img src="https://img.shields.io/badge/Secrets-OpenBao-yellow" alt="OpenBao">
  <img src="https://img.shields.io/badge/TLS-cert--manager-green" alt="cert-manager">
</p>

<p align="center">
  <b>ğŸ”¥ Nuclear Lighters - Hybrid GitOps Multi-Site Infrastructure Since 2024 ğŸ”¥</b>
</p>
