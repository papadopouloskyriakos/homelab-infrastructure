apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: artemis-secrets
  namespace: artemis
  labels:
    app.kubernetes.io/name: artemis
    app.kubernetes.io/component: bgp-hijack-detection
    environment: production
    managed-by: argocd
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: openbao-cluster-store
    kind: ClusterSecretStore
  target:
    name: artemis-secrets
    creationPolicy: Owner
    template:
      type: Opaque
      engineVersion: v2
      data:
        # Database password
        DB_PASS: "{{ .dbPass }}"
        # Admin password for web UI
        ADMIN_PASS: "{{ .adminPass }}"
        # MongoDB password
        MONGODB_PASS: "{{ .mongodbPass }}"
        # RabbitMQ password
        RABBITMQ_PASS: "{{ .rabbitmqPass }}"
        # Hasura admin secret
        HASURA_SECRET: "{{ .hasuraSecret }}"
        # JWT secret for authentication
        JWT_SECRET: "{{ .jwtSecret }}"
        # CSRF protection secret
        CSRF_SECRET: "{{ .csrfSecret }}"
        # API key for frontend
        API_KEY: "{{ .apiKey }}"
        # Captcha secret
        CAPTCHA_SECRET: "{{ .captchaSecret }}"
  data:
    - secretKey: dbPass
      remoteRef:
        key: secret/data/artemis
        property: db_pass
    - secretKey: adminPass
      remoteRef:
        key: secret/data/artemis
        property: admin_pass
    - secretKey: mongodbPass
      remoteRef:
        key: secret/data/artemis
        property: mongodb_pass
    - secretKey: rabbitmqPass
      remoteRef:
        key: secret/data/artemis
        property: rabbitmq_pass
    - secretKey: hasuraSecret
      remoteRef:
        key: secret/data/artemis
        property: hasura_secret
    - secretKey: jwtSecret
      remoteRef:
        key: secret/data/artemis
        property: jwt_secret
    - secretKey: csrfSecret
      remoteRef:
        key: secret/data/artemis
        property: csrf_secret
    - secretKey: apiKey
      remoteRef:
        key: secret/data/artemis
        property: api_key
    - secretKey: captchaSecret
      remoteRef:
        key: secret/data/artemis
        property: captcha_secret
